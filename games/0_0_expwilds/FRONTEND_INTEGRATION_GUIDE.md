# Premium Dragon Wilds - Frontend & RGS Integration Guide

## üìã Overview

This guide provides step-by-step instructions for integrating the Premium Dragon Wilds slot game with the Stake Engine frontend SDK and RGS (Remote Gaming Server). The math backend is complete, and this guide will help you build the visual layer.

---

## üéØ Prerequisites

### Required Repositories
1. **Math SDK** (this repository) - ‚úÖ Complete
2. **Web SDK** - https://github.com/black123411111111111/web-sdk
3. **TypeScript Client** - https://github.com/black123411111111111/ts-cliente

### Required Tools
- Node.js v18.18.0 (use nvm)
- pnpm v10.5.0
- VS Code (recommended)
- Git

### Required Skills
- TypeScript/JavaScript
- Svelte 5
- PixiJS basics
- CSS/HTML

---

## üìÅ Files Generated by Math SDK

The following files are ready in `games/0_0_expwilds/library/`:

### Backend Files (For RGS Upload)
```
publish_files/
‚îú‚îÄ‚îÄ books_base.jsonl.zst          (12 MB)
‚îú‚îÄ‚îÄ books_bonus.jsonl.zst         (32 MB)
‚îú‚îÄ‚îÄ books_superspin.jsonl.zst     (20 MB)
‚îú‚îÄ‚îÄ lookUpTable_base_0.csv        (540 KB)
‚îú‚îÄ‚îÄ lookUpTable_bonus_0.csv       (296 KB)
‚îú‚îÄ‚îÄ lookUpTable_superspin_0.csv   (368 KB)
‚îî‚îÄ‚îÄ index.json                    (manifest)

configs/
‚îú‚îÄ‚îÄ config.json                   (backend config with SHA256 hashes)
‚îî‚îÄ‚îÄ config_fe_0_0_expwilds.json   (488 KB - FRONTEND CONFIG)

forces/
‚îú‚îÄ‚îÄ force.json
‚îî‚îÄ‚îÄ force_record_*.json           (test records)
```

---

## üöÄ Part 1: Frontend Development (web-sdk)

### Step 1: Clone and Setup Web SDK

```bash
# Clone the web-sdk repository
git clone https://github.com/black123411111111111/web-sdk.git
cd web-sdk

# Install Node v18.18.0 using nvm
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash
source ~/.nvm/nvm.sh
nvm install 18.18.0
nvm use 18.18.0

# Install pnpm
npm install -g pnpm@10.5.0

# Install dependencies
pnpm install
```

### Step 2: Create Game Module

Create a new app directory for Premium Dragon Wilds:

```bash
cd web-sdk
mkdir -p apps/dragon-wilds
cd apps/dragon-wilds
```

Create `package.json`:

```json
{
  "name": "dragon-wilds",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite dev",
    "build": "vite build",
    "preview": "vite preview",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build"
  },
  "dependencies": {
    "pixi-svelte": "workspace:*",
    "xstate": "^5.0.0"
  },
  "devDependencies": {
    "@sveltejs/kit": "^2.0.0",
    "@sveltejs/vite-plugin-svelte": "^4.0.0",
    "svelte": "^5.0.0",
    "typescript": "^5.0.0",
    "vite": "^5.0.0"
  }
}
```

### Step 3: Copy Frontend Configuration

Copy the frontend config from math-sdk:

```bash
# From math-sdk repository
cp ../math-sdk/games/0_0_expwilds/library/configs/config_fe_0_0_expwilds.json \
   apps/dragon-wilds/src/config/fe_config.json
```

### Step 4: Create Symbol Assets

You need to create sprite sheets for all game symbols. Create in `apps/dragon-wilds/public/assets/`:

**Required Symbols:**
- `W` - Wild (Dragon themed)
- `H1` - Dragon (premium symbol)
- `H2` - Phoenix
- `H3` - Unicorn
- `H4` - Griffin
- `M1` - Ruby
- `M2` - Emerald
- `L1` - Ace
- `L2` - King
- `L3` - Queen
- `L4` - Jack
- `L5` - Ten
- `S` - Scatter (free spin trigger)
- `GC` - Gold Coin (collection symbol)
- `P` - Prize symbol (for superspin)

**Asset Specifications:**
- Format: PNG with transparency
- Size: 256x256px per symbol
- Sprite sheet or individual files
- Include hover/glow states for wins

### Step 5: Create Core Components

Create `apps/dragon-wilds/src/components/` with:

#### Symbol.svelte
```svelte
<script lang="ts">
  import { Sprite } from 'pixi-svelte';
  
  export let symbol: string;
  export let state: 'normal' | 'winning' | 'anticipation' = 'normal';
  export let x: number = 0;
  export let y: number = 0;
  
  $: texture = `symbols/${symbol}_${state}.png`;
</script>

<Sprite 
  {texture}
  {x} 
  {y}
  anchor={0.5}
/>
```

#### Reel.svelte
```svelte
<script lang="ts">
  import { Container } from 'pixi-svelte';
  import Symbol from './Symbol.svelte';
  
  export let symbols: string[];
  export let x: number;
  export let spinning: boolean = false;
</script>

<Container {x} y={0}>
  {#each symbols as symbol, i}
    <Symbol 
      {symbol}
      y={i * 256}
    />
  {/each}
</Container>
```

#### Board.svelte
```svelte
<script lang="ts">
  import { Container } from 'pixi-svelte';
  import Reel from './Reel.svelte';
  
  export let board: string[][];
  export let spinning: boolean = false;
</script>

<Container x={100} y={100}>
  {#each board as reelSymbols, i}
    <Reel 
      symbols={reelSymbols}
      x={i * 280}
      {spinning}
    />
  {/each}
</Container>
```

### Step 6: Create Game State Machine

Create `apps/dragon-wilds/src/machines/gameMachine.ts`:

```typescript
import { setup, assign } from 'xstate';

export const gameMachine = setup({
  types: {} as {
    context: {
      balance: number;
      bet: number;
      mode: 'base' | 'bonus' | 'superspin';
      board: string[][];
      wins: any[];
      freespinsRemaining: number;
    };
    events: 
      | { type: 'PLACE_BET' }
      | { type: 'SPIN_COMPLETE'; board: string[][] }
      | { type: 'SHOW_WINS'; wins: any[] }
      | { type: 'END_ROUND' }
      | { type: 'TRIGGER_FREESPINS'; count: number };
  },
}).createMachine({
  id: 'dragonWilds',
  initial: 'idle',
  context: {
    balance: 1000,
    bet: 1,
    mode: 'base',
    board: [],
    wins: [],
    freespinsRemaining: 0,
  },
  states: {
    idle: {
      on: {
        PLACE_BET: 'spinning',
      },
    },
    spinning: {
      on: {
        SPIN_COMPLETE: {
          target: 'showingResult',
          actions: assign({
            board: ({ event }) => event.board,
          }),
        },
      },
    },
    showingResult: {
      on: {
        SHOW_WINS: {
          target: 'celebrating',
          actions: assign({
            wins: ({ event }) => event.wins,
          }),
        },
        END_ROUND: 'idle',
      },
    },
    celebrating: {
      after: {
        2000: 'idle',
      },
    },
  },
});
```

### Step 7: Create Main Game Component

Create `apps/dragon-wilds/src/App.svelte`:

```svelte
<script lang="ts">
  import { Application } from 'pixi-svelte';
  import { useMachine } from '@xstate/svelte';
  import { gameMachine } from './machines/gameMachine';
  import Board from './components/Board.svelte';
  
  const { state, send } = useMachine(gameMachine);
  
  function placeBet() {
    send({ type: 'PLACE_BET' });
    // Call RGS API here
  }
</script>

<Application width={1920} height={1080} backgroundColor={0x1a1a2e}>
  <Board 
    board={$state.context.board}
    spinning={$state.matches('spinning')}
  />
</Application>

<div class="ui-overlay">
  <button on:click={placeBet} disabled={!$state.matches('idle')}>
    SPIN
  </button>
  <div class="balance">Balance: ${$state.context.balance}</div>
</div>
```

### Step 8: Test with Storybook

Create `.storybook/main.ts` and add stories in `src/stories/`:

```bash
pnpm run storybook --filter=dragon-wilds
```

Navigate to `http://localhost:6006` to see your game in Storybook.

---

## üîå Part 2: RGS Integration (ts-cliente)

### Step 1: Understanding the RGS Flow

The RGS (Remote Gaming Server) handles:
1. Player authentication
2. Balance management
3. Game round initiation (`/play` API)
4. Game round completion (`/end-round` API)
5. Serving math files (books, lookup tables)

### Step 2: Upload Math Files to Stake Engine

1. **Login to Stake Engine ACP** (Admin Control Panel)
2. **Navigate to**: Games ‚Üí Upload Math Files
3. **Upload the following files**:

```
From: games/0_0_expwilds/library/publish_files/
- books_base.jsonl.zst
- books_bonus.jsonl.zst
- books_superspin.jsonl.zst
- lookUpTable_base_0.csv
- lookUpTable_bonus_0.csv
- lookUpTable_superspin_0.csv
- index.json

From: games/0_0_expwilds/library/configs/
- config.json

From: games/0_0_expwilds/library/forces/
- force.json
```

4. **Verify SHA256 hashes** match what's in `config.json`
5. **Set game status** to "Testing"

### Step 3: Configure TypeScript Client

Clone and setup ts-cliente:

```bash
git clone https://github.com/black123411111111111/ts-cliente.git
cd ts-cliente
npm install
```

Update configuration to point to your game:

```typescript
// config.ts
export const RGS_CONFIG = {
  gameId: '0_0_expwilds',
  gameName: 'Premium Dragon Wilds',
  rgsUrl: 'https://rgs.stake.com',
  modes: ['base', 'bonus', 'superspin'],
};
```

### Step 4: Implement RGS API Calls

Create `src/api/rgs.ts`:

```typescript
export interface PlayRequest {
  gameId: string;
  mode: string;
  bet: number;
  sessionToken: string;
}

export interface PlayResponse {
  balance: {
    amount: number;
    currency: string;
  };
  round: {
    betID: string;
    amount: number;
    active: boolean;
    state: Array<{
      index: number;
      type: string;
      numberRolled: number;
      totalWin: number;
      board?: string[][];
      wins?: any[];
    }>;
  };
}

export async function playRound(request: PlayRequest): Promise<PlayResponse> {
  const response = await fetch(`${RGS_CONFIG.rgsUrl}/play`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${request.sessionToken}`,
    },
    body: JSON.stringify({
      gameId: request.gameId,
      mode: request.mode,
      bet: request.bet,
    }),
  });
  
  if (!response.ok) {
    throw new Error(`RGS Error: ${response.statusText}`);
  }
  
  return response.json();
}

export async function endRound(betID: string, sessionToken: string): Promise<void> {
  const response = await fetch(`${RGS_CONFIG.rgsUrl}/end-round`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${sessionToken}`,
    },
    body: JSON.stringify({ betID }),
  });
  
  if (!response.ok) {
    throw new Error(`RGS Error: ${response.statusText}`);
  }
}
```

### Step 5: Connect Frontend to RGS

Update `App.svelte` to use RGS:

```svelte
<script lang="ts">
  import { playRound, endRound } from './api/rgs';
  
  async function placeBet() {
    send({ type: 'PLACE_BET' });
    
    try {
      const response = await playRound({
        gameId: '0_0_expwilds',
        mode: $state.context.mode,
        bet: $state.context.bet,
        sessionToken: getSessionToken(),
      });
      
      // Process response
      const gameState = response.round.state[0];
      send({ 
        type: 'SPIN_COMPLETE',
        board: gameState.board,
      });
      
      if (gameState.totalWin > 0) {
        send({
          type: 'SHOW_WINS',
          wins: gameState.wins,
        });
        
        // End round after celebration
        setTimeout(async () => {
          await endRound(response.round.betID, getSessionToken());
          send({ type: 'END_ROUND' });
        }, 3000);
      }
    } catch (error) {
      console.error('RGS Error:', error);
    }
  }
</script>
```

---

## üé® Part 3: Animation & Polish

### Required Animations

1. **Reel Spin Animation**
   - Blur effect during spin
   - Ease-in/ease-out
   - Stop with bounce

2. **Win Celebration**
   - Symbol glow/pulse
   - Particle effects
   - Win counter increment
   - Payline highlights

3. **Feature Triggers**
   - Scatter appearance effect
   - Free spin transition
   - Wild expansion animation
   - Cascade/tumble animation

4. **UI Animations**
   - Button hover/press states
   - Balance updates
   - Win counter
   - Mode indicators

### Using Spine Animations

For complex character animations, use Spine:

```svelte
<script lang="ts">
  import { SpineTrack } from 'pixi-svelte';
  
  export let animationName: string = 'idle';
</script>

<SpineTrack 
  trackIndex={0}
  {animationName}
  loop={true}
/>
```

### Sound Effects

Add audio for:
- Reel spin
- Symbol land
- Win celebration
- Feature trigger
- Background music

```typescript
import { sound } from '@pixi/sound';

sound.add('spin', 'assets/sounds/spin.mp3');
sound.add('win', 'assets/sounds/win.mp3');
sound.add('bigwin', 'assets/sounds/bigwin.mp3');

// Play sound
sound.play('spin');
```

---

## üß™ Part 4: Testing

### Local Testing with Storybook

1. **Test individual components**:
   ```bash
   pnpm run storybook --filter=dragon-wilds
   ```

2. **Navigate to component stories**:
   - `COMPONENTS/Symbol/component`
   - `COMPONENTS/Board/default`
   - `MODE_BASE/book/random`

3. **Test game flow**:
   - Click "Action" button
   - Verify spin animation
   - Check win calculations
   - Test feature triggers

### RGS Integration Testing

1. **Upload to Stake Engine staging**
2. **Test each game mode**:
   - Base game (standard play)
   - Bonus buy (100x bet)
   - Superspin (25x bet)

3. **Verify**:
   - Balance updates correctly
   - Wins match lookup tables
   - Free spins trigger properly
   - Round completion works

4. **Test edge cases**:
   - Max win (10,000x)
   - Multiple cascades
   - Freespin retriggers
   - Network errors

---

## üì¶ Part 5: Build & Deploy

### Build Frontend

```bash
cd web-sdk/apps/dragon-wilds
pnpm run build
```

Output will be in `dist/` directory.

### Upload Frontend to Stake Engine

1. **Navigate to**: Stake Engine ACP ‚Üí Games ‚Üí Frontend Files
2. **Upload all files** from `dist/` directory
3. **Set entry point**: `index.html`
4. **Configure**: Link to math files (auto-detected via game ID)

### Final Verification

1. **Launch game** in Stake Engine
2. **Play test rounds** in all modes
3. **Verify**:
   - Visual display matches math results
   - Balance updates correctly
   - All features work
   - Performance is smooth (60 FPS)

4. **Submit for approval**

---

## üìö Resources

### Documentation
- Math SDK Docs: `docs/math_docs/`
- Frontend SDK Docs: `docs/fe_docs/`
- RGS API Docs: `docs/rgs_docs/`

### Example Games
- Lines Game: `web-sdk/apps/lines/`
- Ways Game: `math-sdk/games/0_0_ways/`
- Scatter Game: `math-sdk/games/0_0_scatter/`

### External Links
- PixiJS Docs: https://pixijs.download/release/docs/
- Svelte 5 Docs: https://svelte.dev/docs/
- Storybook Docs: https://storybook.js.org/
- XState Docs: https://stately.ai/docs/

---

## ‚ùì Troubleshooting

### Common Issues

**Issue**: Symbols not loading
- **Solution**: Check asset paths in `public/assets/`
- **Solution**: Verify texture names match symbol IDs

**Issue**: RGS connection errors
- **Solution**: Check sessionToken is valid
- **Solution**: Verify game is in "Testing" status
- **Solution**: Check CORS configuration

**Issue**: Win calculations don't match
- **Solution**: Verify you're using correct lookup table
- **Solution**: Check simulation number matches
- **Solution**: Ensure no client-side RTP modifications

**Issue**: Animation performance issues
- **Solution**: Use sprite sheets instead of individual images
- **Solution**: Limit particle count
- **Solution**: Use WebGL rendering
- **Solution**: Optimize asset sizes

---

## üéØ Success Checklist

Before submitting to Stake Engine:

- [ ] All 15+ symbols created with proper dimensions
- [ ] Reel spin animations smooth at 60 FPS
- [ ] Win celebrations implemented for all win types
- [ ] Feature triggers work (free spins, cascades, wilds)
- [ ] All 3 game modes functional (base, bonus, superspin)
- [ ] RGS integration complete with proper error handling
- [ ] Balance updates correctly
- [ ] SHA256 hashes verified
- [ ] Tested on desktop and mobile
- [ ] Sound effects and music added
- [ ] Loading screen implemented
- [ ] Responsive design works at all resolutions
- [ ] Accessibility features added (if required)
- [ ] Performance optimized (< 100ms response time)
- [ ] All Stake Engine compliance requirements met

---

## üéâ Completion

Once all steps are complete:

1. **Notify Stake Engine** support team
2. **Submit for review** via ACP
3. **Wait for approval** (typically 1-2 weeks)
4. **Deploy to production** once approved

Congratulations! Your Premium Dragon Wilds slot game is ready for players! üêâ‚ú®

---

*For questions or support, refer to Stake Engine developer documentation or contact their support team.*
